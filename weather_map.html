<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>

<!--MAPBOX CSS-->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
    #map {
    /* the width and height may be set to any size */
    width: 95%;
    height: 400px;
    display: flex;
    border-radius: 20px;
    border: #a6a1a1 15px solid;
    }

    img {
        width: 50px;
        height: auto;
    }

    .searchDiv {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

    }
    #weatherContainer {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-content: space-between;
        width: 100%;
        max-width: 75%;
    }

    #iconsContainer {
        border-radius: 20px;
        border: #111111 solid;
        justify-content: space-around;
        width: 100%;

    }

    .col-md-2 {
        border-radius: 20px;
        border: #111111 solid;

    }


</style>
</head>
<body>


<!--Search Container-->
<div class="searchDiv">
    <h1>5-Day Weather Forecast</h1>
    <p id="inputContainer">City: <input type="text" id="cityInput"></p>
    <button type="button" id="searchBtn">Search</button>
    <h2 id="cityName">--San Antonio--</h2>
</div>
<br>
<!--Weather Container-->
<div class="container" id="weatherContainer">
    <div class="row" id="iconsContainer">
        <div class="col-md-2">
            <p class="weather" id="day1">Day 1</p>
            <div class="image"><img src="img/apple-weather-logo.webp" class="imgClass" id="img1" alt="weather-icons"/></div>
            <p class="currentMin" id="day1Temp">Loading..</p>
            <p class="currentMax" id="day1Max">Loading..</p>
            <p class="description" id="day1Description"></p>
        </div>
        <div class="col-md-2">
            <p class="weather" id="day2">Day 2</p>
            <div class="image"><img src="img/apple-weather-logo.webp" class="imgClass" id="img2" alt="weather-icons"></div>
            <p class="currentMin" id="day2Temp">Loading..</p>
            <p class="currentMax" id="day2Max">Loading..</p>
            <p class="description" id="day2Description"></p>

        </div>
        <div class="col-md-2">
            <p class="weather" id="day3">Day 3</p>
            <div class="image"><img src="img/apple-weather-logo.webp" class="imgClass" id="img3" alt="weather-icons"></div>
            <p class="currentMin" id="day3Temp">Loading..</p>
            <p class="currentMax" id="day3Max">Loading..</p>
            <p class="description" id="day3Description"></p>

        </div>
        <div class="col-md-2">
            <p class="weather" id="day4">Day 4</p>
            <div class="image"><img src="img/apple-weather-logo.webp" class="imgClass" id="img4" alt="weather-icons"></div>
            <p class="currentMin" id="day4Temp">Loading..</p>
            <p class="currentMax" id="day4Max">Loading..</p>
            <p class="description" id="day4Description"></p>

        </div>
        <div class="col-md-2">
            <p class="weather" id="day5">Day 5</p>
            <div class="image"><img src="img/apple-weather-logo.webp" class="imgClass" id="img5" alt="weather-icons"></div>
            <p class="currentMin" id="day5Temp">Loading..</p>
            <p class="currentMax" id="day5Max">Loading..</p>
            <p class="description" id="day5Description"></p>


        </div>
    </div>
</div>
<br>
<hr>

<pre id="coordinates" class="coordinates"></pre>
<div id='map'></div>


<!--Keys-->
<script src="js/keys.js"></script>

<!-- Mapbox JS -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

<!-- Mapbox Geocoder Util Methods -->
<script src="js/mapbox-geocoder-utils.js"></script>


<script>
"use strict";
(async function () {
let newMarker;
    // Open Weather

function getCity() {
    let queryParams = new URLSearchParams({
        APPID: OPENWEATHER_API_KEY,
        lat: 29.423017,
        lon: -98.48527,
        // q: "San Antonio, US",
        units: "imperial"
    });
    const url = "https://api.openweathermap.org/data/2.5/onecall?" + queryParams;
    console.log(url);
    fetch(url)
        .then(function (response) {
            return response.json();
        }).then(function (data) {
        console.log(data)
        for (let i = 0; i < 5; i++) {
            // Weather img
            document.getElementById("img" + (i + 1)).src = "http://openweathermap.org/img/wn/" + `${data.daily[i].weather[0].icon}` + ".png"
            // Date/Day
            document.getElementById("day" + (i + 1)).innerHTML = `${new Date(data.daily[i].dt * 1000).toDateString()}`
            // Min temp
            document.getElementById("day" + (i + 1) + "Temp").innerHTML = "Min Temp " + data.daily[i].temp.min.toFixed(1) + "°";
            // Max temp
            document.getElementById("day" + (i + 1) + "Max").innerHTML = "Max Temp " + data.daily[i].temp.max.toFixed(1) + "°";
            document.getElementById("day" + (i + 1) + "Description").innerHTML = "Description: " + `${data.daily[i].weather[0].description}`
        }

        console.log(data);
    })
}







    function location() {
        let newName = document.getElementById('cityInput');
        let cityName = document.getElementById("cityName");
        cityName.innerHTML = "--" + newName.value + "--"
    }


    const search = document.getElementById("searchBtn")
    search.addEventListener("click", location, getCity)


    document.getElementById("cityInput").defaultValue = "San Antonio";
    location();
    getCity();






// Weather MAP
    let accessToken = MAPBOX_API_KEY;

    mapboxgl.accessToken = accessToken;

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        zoom: 10,
        center: [-98.4916, 29.4252]

    });



    // function getLogLatFromAddress (address, token = MAPBOX_API_KEY) {
    //     let baseUrl = 'https://api.mapbox.com';
    //     let endPoint = '/geocoding/v5/mapbox.places/';
    // }

    const searchedMarker = [];

    let searchButton = document.getElementById(`searchBtn`);
    let searchInput = document.getElementById('cityInput');
    let cityDisplayed = document.getElementById("cityName");
    searchButton.addEventListener("click", async function(event) {
        console.log(searchInput)
        let searchCoords = (await getLocationInfoFromAddress(searchInput.value));
        map.setCenter(searchCoords);
        newMarker.remove()
        newMarker = new mapboxgl.Marker({draggable: true});
        newMarker.setLngLat(searchCoords);
        newMarker.addTo(map);
        onDragEnd();
        newMarker.on('dragend', onDragEnd);
        searchedMarker.push(newMarker);
    })

    const coordinates = document.getElementById('coordinates');
    newMarker = new mapboxgl.Marker({
        draggable:true
    })
    newMarker.setLngLat([-98.489765, 29.426742])
    newMarker.addTo(map);

    function onDragEnd() {
        const lngLat = newMarker.getLngLat();
        console.log(lngLat);
        coordinates.style.display = 'block';
        coordinates.innerHTML = `Longitude: ${lngLat.lng}<br />Latitude: ${lngLat.lat}`;
        map.setCenter(lngLat);
        getCity();

    }
    newMarker.on('dragend', onDragEnd);





})();


</script>



</body>
</html>